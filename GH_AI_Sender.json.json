{"mode":"block","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"`3Dj-C/0x#:ph0c{tJfX\">time</variable></variables><block type=\"ai_event_forever\" id=\"476+L,b7`_XJF_cC5H%/\" x=\"-1637\" y=\"-913\"><statement name=\"ONSTART\"><block type=\"ai_display_turnon_camera\" id=\"Z+RVA|~q0.MGmUIQ~uA`\"><field name=\"camera\">environment</field><next><block type=\"ai_speech_rec_event\" id=\"iQo}jSkUKCEN40*2t8;;\"><field name=\"language\">vi-VN</field><statement name=\"event_handler\"><block type=\"ai_display_background\" id=\"Y(^SVN74xXCZ_5hj5h5n\"><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"M4OZ)r,vJxZv#1|yNbOv\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"ai_display_text\" id=\"3G2QFRe9#MCe%rU[g+}j\"><value name=\"TEXT\"><shadow type=\"text\" id=\"aw(.D+G2)qIEP~}Px}f%\"><field name=\"TEXT\">Hello</field></shadow><block type=\"ai_speech_rec_result\" id=\"tc:9dFAG=GLg^|]C}s;:\"></block></value><value name=\"X\"><shadow type=\"math_number\" id=\"+a`fu]C9xl/#dhzsUcC`\"><field name=\"NUM\">100</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"Bu8FP0%k$]Zj8IY)!0b*\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"controls_if\" id=\"[Cjh*iDkNO,}b8Y*eqdV\"><mutation elseif=\"6\"></mutation><value name=\"IF0\"><block type=\"logic_operation\" id=\"lJ[m,3}rD;;gr=oBS6vv\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_operation\" id=\"E~Jm_,zN2rk`V:gD(E9B\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"j(v$r@Y[btkpO*I89P]C\"><value name=\"check_values\"><shadow type=\"text\" id=\"ma(sB7(R0][alR@V[Qa*\"><field name=\"TEXT\">bơm</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"{9uD7Eek[PONC3,DG0c`\"><value name=\"check_values\"><shadow type=\"text\" id=\"s_AzFm8/|o[}1QaHSfg|\"><field name=\"TEXT\">tưới</field></shadow></value></block></value></block></value><value name=\"B\"><block type=\"logic_negate\" id=\"`S3/V{_g?VLCXx{[9T6a\"><value name=\"BOOL\"><block type=\"logic_operation\" id=\"Zte5Hy/`B?z2Fa55$2`,\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"lKSL%uR/c]H0.fRcA4ux\"><value name=\"check_values\"><shadow type=\"text\" id=\":s*^J?-s:^|);PlV*giT\"><field name=\"TEXT\">mililít</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"K!S6Kx]KKzf%@uY:1z{r\"><value name=\"check_values\"><shadow type=\"text\" id=\"7z$mg:@9@j@d.8,kON*.\"><field name=\"TEXT\">mi li lít</field></shadow></value></block></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_device_send_string\" id=\"HYOK+E-.ajfo/WAGWziL\"><value name=\"message\"><shadow type=\"text\" id=\"Gt3@ANL%uX4Om-X`MY:}\"><field name=\"TEXT\">1?</field></shadow></value></block></statement><value name=\"IF1\"><block type=\"logic_operation\" id=\"Dj%S7!u{m*vn$Aiv$%pN\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"|Y;Zr,wu^Qe2Y!r[pS[0\"><value name=\"check_values\"><shadow type=\"text\" id=\"7dR-6i9[}|G?N+![qN[F\"><field name=\"TEXT\">dừng</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"C2=hoe,g+F{W|@9MX3MX\"><value name=\"check_values\"><shadow type=\"text\" id=\"90G|:lM?dS|$$;Wca.#M\"><field name=\"TEXT\">ngưng</field></shadow></value></block></value></block></value><statement name=\"DO1\"><block type=\"ai_device_send_string\" id=\"oKkZM)EFM.(gYg}.a%sT\"><value name=\"message\"><shadow type=\"text\" id=\"T@bTFIfQgA}OzorWzNjt\"><field name=\"TEXT\">0?</field></shadow></value></block></statement><value name=\"IF2\"><block type=\"logic_operation\" id=\"bnz%Rk(-#?I3%Y?=b,)J\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_operation\" id=\"#]wQ%[:[Z[A%JqQUR^Bb\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"1Wvg}f38EqkHn=ro{oN4\"><value name=\"check_values\"><shadow type=\"text\" id=\"F%W.`.1,vihZ:HG%awBb\"><field name=\"TEXT\">hiển thị</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\".B{N`duwikVG25Q!a0OU\"><value name=\"check_values\"><shadow type=\"text\" id=\"`I|V5@~kV{0)IKGMJypO\"><field name=\"TEXT\">hiện</field></shadow></value></block></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"|G1)[4rK5dm^GvbwBi4t\"><value name=\"check_values\"><shadow type=\"text\" id=\"w*`X!!?cJ.wOLgzBfVTZ\"><field name=\"TEXT\">thời gian</field></shadow></value></block></value></block></value><statement name=\"DO2\"><block type=\"ai_device_send_string\" id=\")3sJ}X5Ai.=-5Mzm5!!;\"><value name=\"message\"><shadow type=\"text\" id=\"0|J$*}GQ~22g8`Z$L02`\"><field name=\"TEXT\">0&amp;</field></shadow></value></block></statement><value name=\"IF3\"><block type=\"logic_operation\" id=\"_RZyzoXPBhFo:7h]Q_W=\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_operation\" id=\"yCj8lk:lRXNjAHQTZOJ(\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"bPoforqy4.?EmBgt@dC~\"><value name=\"check_values\"><shadow type=\"text\" id=\"P60ATQW5b8Vx%.i?~eM@\"><field name=\"TEXT\">hiển thị</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"}yJ*J]7d%D(B[nwQVXEM\"><value name=\"check_values\"><shadow type=\"text\" id=\"M0q`o{x[pI{a@50Jto-=\"><field name=\"TEXT\">hiện</field></shadow></value></block></value></block></value><value name=\"B\"><block type=\"logic_operation\" id=\"8*tNu~LmjyfP0[M,6l4X\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"KT_$R5pC5mH]Bnz,Y|8g\"><value name=\"check_values\"><shadow type=\"text\" id=\"i)l/MQlMWn|!ydafMA87\"><field name=\"TEXT\">nhiệt độ</field></shadow></value></block></value><value name=\"B\"><block type=\"logic_operation\" id=\")z)));uiUJ.`=T}BYHe=\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"|D/ve9No1N#I-S=W`si=\"><value name=\"check_values\"><shadow type=\"text\" id=\"}|@0ibGLw0B-0Cu7g!Q)\"><field name=\"TEXT\">độ ẩm</field></shadow></value></block></value><value name=\"B\"><block type=\"logic_negate\" id=\"8T=[Tol}j)/P!a$RNYnJ\"><value name=\"BOOL\"><block type=\"ai_speech_rec_result_check\" id=\"|+q2:s*6H7-@;~~iXJ9t\"><value name=\"check_values\"><shadow type=\"text\" id=\"O@/*3+|k#U~P*)@~OriC\"><field name=\"TEXT\">đất</field></shadow></value></block></value></block></value></block></value></block></value></block></value><statement name=\"DO3\"><block type=\"ai_device_send_string\" id=\"izOHS%uUDuEqd$mtjast\"><value name=\"message\"><shadow type=\"text\" id=\"A#A{$SXrhz5UtBzT?]u~\"><field name=\"TEXT\">1&amp;</field></shadow></value></block></statement><value name=\"IF4\"><block type=\"logic_operation\" id=\":s@O@Gew{Dnn3uUSv{iK\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_operation\" id=\"B5qy.]u_VDbdD@Us[1EZ\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"J_*-7(gq3ERgTU+QR)[b\"><value name=\"check_values\"><shadow type=\"text\" id=\"Xj~}ix*/!w|znI_I|lVH\"><field name=\"TEXT\">hiển thị</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"TLg)du(,i$Yz^0q|$U!q\"><value name=\"check_values\"><shadow type=\"text\" id=\"[a!eF!cSUtqK:ih37]wP\"><field name=\"TEXT\">hiện</field></shadow></value></block></value></block></value><value name=\"B\"><block type=\"logic_operation\" id=\"aiwXcAPJ:VJ/vDh[oF-Z\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"Z2JQU,meqX+TItnhj=63\"><value name=\"check_values\"><shadow type=\"text\" id=\"S;um^ix?hfx;g)vBy!N2\"><field name=\"TEXT\">ngày tăng trưởng</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"zoMcX+/WSjK`[:$.:tR)\"><value name=\"check_values\"><shadow type=\"text\" id=\"2J59jp$Jt?zD3VI!2#%B\"><field name=\"TEXT\">độ sáng</field></shadow></value></block></value></block></value></block></value><statement name=\"DO4\"><block type=\"ai_device_send_string\" id=\"U^p6,i%)DGv,[9V|kT.z\"><value name=\"message\"><shadow type=\"text\" id=\"s.|%M-mrHV0Sk^7+b4~2\"><field name=\"TEXT\">2&amp;</field></shadow></value></block></statement><value name=\"IF5\"><block type=\"logic_operation\" id=\"pjD|tXdkf`_r3^vg7^Y9\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_operation\" id=\"KE}+1ts/G4KgAn]vq`U_\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"~A$L(^,pXg|Ro|h$^TrU\"><value name=\"check_values\"><shadow type=\"text\" id=\"3y)--s_2jXw6*4S=[O^z\"><field name=\"TEXT\">hiển thị</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"[/Q@0~SH^AtUDJ]W|^eJ\"><value name=\"check_values\"><shadow type=\"text\" id=\"K?WCzAc`~V3cNTu/qmj(\"><field name=\"TEXT\">hiện</field></shadow></value></block></value></block></value><value name=\"B\"><block type=\"logic_operation\" id=\"13B$2u#%a;#5#w*O02S0\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"kK,nN?%EU9:wVqrDmT#2\"><value name=\"check_values\"><shadow type=\"text\" id=\"g9d^!?wyfVb.DrX4=am-\"><field name=\"TEXT\">độ ẩm, đất</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"bpfc]%P2eHs{fcy*c}0i\"><value name=\"check_values\"><shadow type=\"text\" id=\".m|-N[f)1K$hl*FSaQ.y\"><field name=\"TEXT\">trạng thái</field></shadow></value></block></value></block></value></block></value><statement name=\"DO5\"><block type=\"ai_device_send_string\" id=\"NFeZ(?Chd,V[BXHFE;.v\"><value name=\"message\"><shadow type=\"text\" id=\"*q_xth+l0~a(V(FUWY^d\"><field name=\"TEXT\">3&amp;</field></shadow></value></block></statement><value name=\"IF6\"><block type=\"logic_operation\" id=\"K@OC7)6yj/uN#poh]Wo-\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"wHLkBp0$wyW.n1U3Bkz:\"><value name=\"check_values\"><shadow type=\"text\" id=\"/(.:Ifm+@9o95w00?z0l\"><field name=\"TEXT\">tưới</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"q9qX/zolN|KQ{ySCn~%Y\"><value name=\"check_values\"><shadow type=\"text\" id=\"gU*PI7p:nf?kG^GW1nq@\"><field name=\"TEXT\">mi li lít</field></shadow></value></block></value></block></value><statement name=\"DO6\"><block type=\"variables_set\" id=\"b_jvd.@4fTY1Nfx)ah|!\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field><value name=\"VALUE\"><block type=\"ai_speech_rec_result\" id=\"F~z^eZ+?graC)*B1BVi_\"></block></value><next><block type=\"variables_set\" id=\"bD[.hf8UZQZn4:d[QSX{\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field><value name=\"VALUE\"><block type=\"lists_getSublist\" id=\"}yE3g38o}QgL-MYUx?$.\"><mutation at1=\"true\" at2=\"true\"></mutation><field name=\"WHERE1\">FROM_START</field><field name=\"WHERE2\">FROM_END</field><value name=\"LIST\"><block type=\"variables_get\" id=\"SYl|GP?qP,VjY@g(zM%F\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field></block></value><value name=\"AT1\"><block type=\"math_number\" id=\"*KW@D@aj(;Yhl|M6,DR8\"><field name=\"NUM\">6</field></block></value><value name=\"AT2\"><block type=\"math_number\" id=\"gPk~)83#rS8KO]!fNMF?\"><field name=\"NUM\">12</field></block></value></block></value><next><block type=\"text_append\" id=\"cJnSdX-_A):EwRnaF~%Z\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field><value name=\"TEXT\"><shadow type=\"text\" id=\"%o2:EM:$fKo3rk[iZQo:\"><field name=\"TEXT\">/</field></shadow></value><next><block type=\"ai_display_text\" id=\"D:}.`:]t4QbO$l.*na%`\"><value name=\"TEXT\"><shadow type=\"text\" id=\"F}XFR9hVZ.m7V|s~KwPv\"><field name=\"TEXT\">Hello</field></shadow><block type=\"variables_get\" id=\"bw^PR18Tyr,87a]Y1uGD\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field></block></value><value name=\"X\"><shadow type=\"math_number\" id=\"zI4nqjHeg+p0@}3.nozn\"><field name=\"NUM\">300</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"uO{xuK)eF[o`O-?zFy?v\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"ai_device_send_string\" id=\"Gfbopfx,ci$gu#pKYVo^\"><value name=\"message\"><shadow type=\"text\" id=\"BAHCV~J4_?9u:t3#IisC\"><field name=\"TEXT\">3&amp;</field></shadow><block type=\"variables_get\" id=\"Au5plSYl8ns^mmOTbG-,\"><field name=\"VAR\" id=\"`3Dj-C/0x#:ph0c{tJfX\">time</field></block></value></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></statement><next><block type=\"ai_ml_image_classify_event_delay\" id=\",[RI)JPM)@t~WS(g12|@\"><field name=\"delay\">60</field><field name=\"mirror\">TRUE</field><field name=\"model\">014067b1-bc17-4214-a1c1-099bc1cb3f91</field><statement name=\"event_handler\"><block type=\"ai_display_background\" id=\"Y?]5zP;?|t71[0bA].s6\"><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"b2/Y5x|XeeK$wwiS_n|#\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"ai_display_text\" id=\"(f3o-#Kk-.8s!:fQ.l(l\"><value name=\"TEXT\"><shadow type=\"text\" id=\"8J54]%6T@AKEZ``SnmF%\"><field name=\"TEXT\">Hello</field></shadow><block type=\"ai_ml_classify_result\" id=\"x4r,{U+7(6MD9/skfnjx\"><field name=\"type\">label</field><value name=\"order\"><shadow type=\"math_number\" id=\"MQ,jgr3/;lKpI!%gz=(9\"><field name=\"NUM\">1</field></shadow></value></block></value><value name=\"X\"><shadow type=\"math_number\" id=\"R!Tg_hn1!u5MyARtB%W0\"><field name=\"NUM\">100</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"p!4L|dN|4=sbjbb71`7P\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"controls_if\" id=\"t-@^00_R/A8$UkkyYhj_\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><block type=\"ai_ml_classify_result_compare_label\" id=\"=L]+{mnR``MOVXbdA#Td\"><value name=\"index\"><shadow type=\"math_number\" id=\"%j5)x%1hW/WBTJzXZhbp\"><field name=\"NUM\">1</field></shadow></value><value name=\"label\"><shadow type=\"text\" id=\"0#THAjyE8EkWZn^m}IKz\"><field name=\"TEXT\">LaXanh</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"ai_device_send_string\" id=\"AFe0]1$VTV~)o[*~PZH-\"><value name=\"message\"><shadow type=\"text\" id=\"iB-${n8M(P#Kbq?U9K?e\"><field name=\"TEXT\">binh thuong%</field></shadow></value></block></statement><value name=\"IF1\"><block type=\"ai_ml_classify_result_compare_label\" id=\"NO;TSHF6n)Px5PMcv7q*\"><value name=\"index\"><shadow type=\"math_number\" id=\"{ahdBb7*Fdh(~7IsfiE/\"><field name=\"NUM\">1</field></shadow></value><value name=\"label\"><shadow type=\"text\" id=\"=eEI=K%la]9IWGO@f2i~\"><field name=\"TEXT\">LaVang</field></shadow></value></block></value><statement name=\"DO1\"><block type=\"ai_device_send_string\" id=\"rm9`1[uVKx^J{GVYHj;e\"><value name=\"message\"><shadow type=\"text\" id=\"@L9]7kT6;bi-l}%RB4ag\"><field name=\"TEXT\">bi benh%</field></shadow></value></block></statement></block></next></block></next></block></statement></block></next></block></next></block></statement><statement name=\"FOREVER\"><block type=\"ai_display_image_camera\" id=\"YZ|;]0jZw+2l|vAgLLQJ\"><field name=\"MIRROR\">TRUE</field><value name=\"X\"><shadow type=\"math_number\" id=\"A-.X^M5(h7`2#`=O=3wM\"><field name=\"NUM\">0</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"YEF;d|Fb#`}U?EJ+u4UO\"><field name=\"NUM\">0</field></shadow></value><value name=\"WIDTH\"><shadow type=\"math_number\" id=\"oLr~[Fu`$rP$1H@x/0.t\"><field name=\"NUM\">320</field></shadow></value><value name=\"HEIGHT\"><shadow type=\"math_number\" id=\"E^;e#QSS#RJoy68-Hxq3\"><field name=\"NUM\">240</field></shadow></value></block></statement></block></xml>","javascript":"var time;\n\nfunction p5speechRecGotResult() {\n  background('#ffffff');\n  text((p5SpeechRec.resultString.toLowerCase()) , 100, 300);\n  if ((new RegExp('bơm'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('tưới'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) && !(new RegExp('mililít'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('mi li lít'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()))) {\n    parent.commandUtils.sendTerminalData('1?');\n  } else if (new RegExp('dừng'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('ngưng'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    parent.commandUtils.sendTerminalData('0?');\n  } else if ((new RegExp('hiển thị'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('hiện'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) && new RegExp('thời gian'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    parent.commandUtils.sendTerminalData('0&');\n  } else if ((new RegExp('hiển thị'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('hiện'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) && (new RegExp('nhiệt độ'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('độ ẩm'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && !new RegExp('đất'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()))) {\n    parent.commandUtils.sendTerminalData('1&');\n  } else if ((new RegExp('hiển thị'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('hiện'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) && (new RegExp('ngày tăng trưởng'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('độ sáng'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()))) {\n    parent.commandUtils.sendTerminalData('2&');\n  } else if ((new RegExp('hiển thị'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('hiện'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) && (new RegExp('độ ẩm, đất'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('trạng thái'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()))) {\n    parent.commandUtils.sendTerminalData('3&');\n  } else if (new RegExp('tưới'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('mi li lít'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    time = p5SpeechRec.resultString.toLowerCase();\n    time = time.slice(5, time.length - 11);\n    time += '/';\n    text(time , 300, 250);\n    parent.commandUtils.sendTerminalData(time);\n  }\n\n}\n\nfunction p5speechRecOnEnd() {\n  p5SpeechRec.start();\n}\n\nfunction loadAIModel(fromLocal, URI, modelType) { // modelType = 0:image, 1:audio, 2:pose\n  if (fromLocal) {\n    if (modelType == 0) {  // video classification model\n      const projects = JSON.parse(window.localStorage.getItem(\"ohstemai_projects\"));\n      let project;\n      if (projects && projects.data && Boolean(projects.data)) {\n        project = projects.data[URI];\n      }\n\n      parent.tf.loadLayersModel(\"indexeddb://\" + project.id).then((layersModel) => {\n        tmModel = new parent.tm.CustomMobileNet(layersModel, project.metadata);\n      }).catch((err) => console.log(err));\n    } else if (modelType == 1) {  // sound classification model\n      // Load the model first\n      const baseRecognizer = parent.spc.create(\"BROWSER_FFT\");\n      baseRecognizer\n        .ensureModelLoaded()\n        .then(() => {\n          tmModelAudio = baseRecognizer.createTransfer(URI);\n          console.log(`@tensorflow/speech-commands Transfer recognizer created (version ${parent.spc.version})`);\n          console.log(\"loading model\", URI);\n          return tmModelAudio.load();\n      })\n      .then(() => tmModelAudio.ensureModelLoaded())\n      .then(() => {\n        console.log(\"loaded model\", tmModelAudio);\n        // Start classifying\n        classifySound(true);\n      })\n      .catch((err) => console.log(err));\n    }\n  } else {\n    if (modelType == 0) {\n      imageClassifier = ml5.imageClassifier(URI + \"model.json\");\n    } else {\n      soundClassifier = ml5.soundClassifier(URI + \"model.json\");\n    }\n  }\n}\n\nfunction classifyVideoDelay(mirror, useLocalModel, continuous, delay) {\n  if (!parent || Boolean(parent.isStopCode)) {return;}\n\n  let videoImage = mirror?ml5.flipImage(videoCamera):videoCamera;\n  if (useLocalModel) {\n    if (tmModel) {\n      tmModel.predict(mirror?videoImage.canvas:videoImage.elt).then((predictions) => {\n        classifyVideoGotResult(undefined, predictions.sort((a, b) => b.probability - a.probability).map((p) => ({ label: p.className, confidence: p.probability })));\n        if (continuous) {\n          if (delay == 0) {\n            classifyVideoDelay(mirror, useLocalModel, continuous, 0);\n          }\n          else {\n            sleep(aiTimeDelay).then(() => classifyVideoDelay(mirror, useLocalModel, continuous, aiTimeDelay));\n          }\n        }\n      }).catch((err) => classifyVideoGotResult(err, undefined));\n    } else {\n      setTimeout(classifyVideoDelay, 500, mirror, useLocalModel, continuous);\n    }\n  } else {\n    imageClassifier.classify(videoImage, (err, results) => {\n      if (err) {\n        classifyVideoGotResult(err, undefined);\n      } else {\n        classifyVideoGotResult(undefined, results);\n        if (continuous) {\n          if (delay == 0) {\n            classifyVideoDelay(mirror, useLocalModel, continuous, 0);\n          }\n          else {\n            sleep(aiTimeDelay).then(() => classifyVideoDelay(mirror, useLocalModel, continuous, aiTimeDelay));\n          }\n        }\n      }\n    });\n  }\n\n  if (mirror) videoImage.remove();\n}\n\nfunction classifyVideoGotResult(error, classifyResults) {\n  if (error) {\n    console.error(error);\n    return;\n  }\n\n  // handle result here\n  background('#ffffff');\n  text((classifyResults[0].label) , 100, 250);\n  if (classifyResults[0].label == 'LaXanh') {\n    parent.commandUtils.sendTerminalData('binh thuong%');\n  } else if (classifyResults[0].label == 'LaVang') {\n    parent.commandUtils.sendTerminalData('bi benh%');\n  }\n\n}\n\nfunction sleep(s) {\n  ms = s * 1000\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n\nlet videoCamera;\nlet p5SpeechRec = new p5.SpeechRec(\"vi-VN\", p5speechRecGotResult);\np5SpeechRec.onEnd = p5speechRecOnEnd;\nlet imageClassifier;\n\nlet soundClassifier;\n\nlet aiTimeDelay;\nlet tmModel;\n\nfunction preload() {\n  loadAIModel(true, \"014067b1-bc17-4214-a1c1-099bc1cb3f91\", 0);\n}\n\nfunction setup() {\n  createCanvas(window.parent.document.getElementById('js-runner-container').offsetWidth-50, window.parent.document.getElementById('js-runner-container').offsetHeight-50);\n    videoCamera = createCapture({audio: false, video: {facingMode: \"environment\"}});\n  videoCamera.size(width, height);\n  videoCamera.hide();\n  p5SpeechRec.start(); // start listening\n  aiTimeDelay = 60\n  classifyVideoDelay(true, true, true, aiTimeDelay);\n\n}\n\nfunction draw() {\n  let flippedImage = ml5.flipImage(videoCamera);\n  image(flippedImage, 0, 0, 320, 240);\n  flippedImage.remove();\n\n}\n","name":"GH_AI_Sender","extensions":[],"device":"ai"}